import re
import os

# Step 1: Define the output directory name
output_directory = "elec vio"  # You can change this name here

# Step 2: Create the output directory if it doesn't exist
if not os.path.exists(output_directory):
    os.makedirs(output_directory)
    print(f"Created directory: '{output_directory}'")

# Step 3: Define the mapping sections
mapping_text = """
# first to second
FF1023100 = FF1023115
FF1023116 = FF1023131
FF1023089 = FF1023104
FF1023081 = FF1023096
FF1023085 = FF1023100
FF1023082 = FF1023097
FF1023083 = FF1023098
FF1023093 = FF1023108
FF1023092 = FF1023107
FF1023090 = FF1023105
OL1038520 = OL1038521
FF1023254 = FF1023259
FF1023091 = FF1023106
FF1023088 = FF1023103
FF1023094 = FF1023109
FF1023154 = FF1023169
FF1023231 = FF1023232
FF1023242 = FF1023243
MES1012183 = MES1012186
OL1023229 = OL1023256
FF1023253 = FF1023258
FF1023255 = FF1023260
FF1023252 = FF1023257
FF1023101 = FF1023116
FIRST NOTICE OF VIOLATIONS = SECOND NOTICE OF VIOLATIONS
FIRST VIOLATION TICKET = SECOND VIOLATION TICKET
FIRST NOTICE = SECOND NOTICE
FIRST STOP WORK NOTICE = SECOND STOP WORK NOTICE

# second to third
FF1023115 = FF1023130
FF1023131 = FF1023146
FF1023104 = FF1023119
FF1023096 = FF1023111
FF1023100 = FF1023115
FF1023097 = FF1023112
FF1023098 = FF1023113
FF1023108 = FF1023123
FF1023107 = FF1023122
FF1023105 = FF1023120
OL1038521 = OL1038522
FF1023259 = FF1023264
FF1023106 = FF1023121
FF1023103 = FF1023118
FF1023109 = FF1023124
FF1023169 = FF1023184
FF1023232 = FF1023233
FF1023243 = FF1023244
MES1012186 = MES1012188
OL1023256 = OL1023261
FF1023258 = FF1023262
FF1023260 = FF1023265
FF1023257 = FF1023263
FF1023116 = FF1023131
SECOND NOTICE OF VIOLATIONS = THIRD NOTICE OF VIOLATIONS
SECOND VIOLATION TICKET = THIRD VIOLATION TICKET
SECOND NOTICE = THIRD NOTICE
SECOND STOP WORK NOTICE = THIRD STOP WORK NOTICE

# third to fourth
FF1023130 = FF1023145
FF1023146 = FF1023161
FF1023119 = FF1023134
FF1023111 = FF1023126
FF1023115 = FF1023130
FF1023112 = FF1023127
FF1023113 = FF1023128
FF1023123 = FF1023138
FF1023122 = FF1023137
FF1023120 = FF1023135
OL1038522 = OL1038523
FF1023264 = FF1023269
FF1023121 = FF1023136
FF1023118 = FF1023133
FF1023124 = FF1023139
FF1023184 = FF1023199
FF1023233 = FF1023234
FF1023244 = FF1023245
MES1012188 = MES1012190
OL1023261 = OL1023266
FF1023262 = FF1023268
FF1023265 = FF1023270
FF1023263 = FF1023267
FF1023131 = FF1023146
THIRD NOTICE OF VIOLATIONS = FOURTH NOTICE OF VIOLATIONS
THIRD VIOLATION TICKET = FOURTH VIOLATION TICKET
THIRD NOTICE = FOURTH NOTICE
THIRD STOP WORK NOTICE = FOURTH STOP WORK NOTICE

# fourth to fifth
FF1023145 = FF1023160
FF1023161 = FF1023176
FF1023134 = FF1023149
FF1023126 = FF1023141
FF1023130 = FF1023145
FF1023127 = FF1023142
FF1023128 = FF1023143
FF1023138 = FF1023153
FF1023137 = FF1023152
FF1023135 = FF1023150
OL1038523 = OL1038524
FF1023269 = FF1023274
FF1023136 = FF1023151
FF1023133 = FF1023148
FF1023199 = FF1023214
FF1023234 = FF1023235
FF1023245 = FF1023246
MES1012190 = MES1012192
OL1023266 = OL1023271
FF1023268 = FF1023273
FF1023270 = FF1023275
FF1023267 = FF1023272
FF1023146 = FF1023161
FOURTH NOTICE OF VIOLATIONS = FIFTH NOTICE OF VIOLATIONS
FOURTH VIOLATION TICKET = FIFTH VIOLATION TICKET
FOURTH NOTICE = FIFTH NOTICE
FOURTH STOP WORK NOTICE = FIFTH STOP WORK NOTICE

# fifth to sixth
FF1023160 = FF1023175
FF1023176 = FF1023191
FF1023149 = FF1023164
FF1023141 = FF1023156
FF1023145 = FF1023160
FF1023142 = FF1023157
FF1023143 = FF1023158
FF1023153 = FF1023168
FF1023152 = FF1023167
FF1023150 = FF1023165
OL1038524 = OL1038525
FF1023274 = FF1023279
FF1023151 = FF1023166
FF1023148 = FF1023163
FF1023235 = FF1023236
FF1023246 = FF1023247
MES1012192 = MES1012194
OL1023271 = OL1023276
FF1023273 = FF1023278
FF1023275 = FF1023280
FF1023272 = FF1023277
FF1023161 = FF1023176
FIFTH NOTICE OF VIOLATIONS = SIXTH NOTICE OF VIOLATIONS
FIFTH VIOLATION TICKET = SIXTH VIOLATION TICKET
FIFTH NOTICE = SIXTH NOTICE
FIFTH STOP WORK NOTICE = SIXTH STOP WORK NOTICE

# sixth to seventh
FF1023175 = FF1023190
FF1023191 = FF1023206
FF1023164 = FF1023179
FF1023156 = FF1023171
FF1023160 = FF1023175
FF1023157 = FF1023172
FF1023158 = FF1023173
FF1023168 = FF1023183
FF1023167 = FF1023182
FF1023165 = FF1023180
OL1038525 = OL1038526
FF1023279 = FF1023284
FF1023166 = FF1023181
FF1023163 = FF1023178
FF1023236 = FF1023237
FF1023247 = FF1023248
MES1012194 = MES1012196
OL1023276 = OL1023281
FF1023278 = FF1023283
FF1023280 = FF1023285
FF1023277 = FF1023282
FF1023176 = FF1023191
SIXTH NOTICE OF VIOLATIONS = SEVENTH NOTICE OF VIOLATIONS
SIXTH VIOLATION TICKET = SEVENTH VIOLATION TICKET
SIXTH NOTICE = SEVENTH NOTICE
SIXTH STOP WORK NOTICE = SEVENTH STOP WORK NOTICE

# seventh to eighth
FF1023190 = FF1023205
FF1023206 = FF1023221
FF1023179 = FF1023194
FF1023171 = FF1023186
FF1023175 = FF1023190
FF1023172 = FF1023187
FF1023173 = FF1023188
FF1023183 = FF1023198
FF1023182 = FF1023197
FF1023180 = FF1023195
OL1038526 = OL1038527
FF1023284 = FF1023289
FF1023181 = FF1023196
FF1023178 = FF1023193
FF1023237 = FF1023238
FF1023248 = FF1023249
MES1012196 = MES1012198
OL1023281 = OL1023286
FF1023283 = FF1023288
FF1023285 = FF1023290
FF1023282 = FF1023287
FF1023191 = FF1023206
SEVENTH NOTICE OF VIOLATIONS = EIGHTH NOTICE OF VIOLATIONS
SEVENTH VIOLATION TICKET = EIGHTH VIOLATION TICKET
SEVENTH NOTICE = EIGHTH NOTICE
SEVENTH STOP WORK NOTICE = EIGHTH STOP WORK NOTICE

# eighth to ninth
FF1023205 = FF1023220
FF1023194 = FF1023209
FF1023186 = FF1023201
FF1023190 = FF1023205
FF1023187 = FF1023202
FF1023188 = FF1023203
FF1023198 = FF1023213
FF1023197 = FF1023212
FF1023195 = FF1023210
OL1038527 = OL1038528
FF1023289 = FF1023294
FF1023196 = FF1023211
FF1023193 = FF1023208
FF1023238 = FF1023239
FF1023249 = FF1023250
MES1012198 = MES1012200
OL1023286 = OL1023291
FF1023288 = FF1023293
FF1023290 = FF1023295
FF1023287 = FF1023292
FF1023206 = FF1023221
EIGHTH NOTICE OF VIOLATIONS = NINTH NOTICE OF VIOLATIONS
EIGHTH VIOLATION TICKET = NINTH VIOLATION TICKET
EIGHTH NOTICE = NINTH NOTICE
EIGHTH STOP WORK NOTICE = NINTH STOP WORK NOTICE

# ninth to tenth
FF1023209 = FF1023224
FF1023201 = FF1023216
FF1023205 = FF1023220
FF1023202 = FF1023217
FF1023203 = FF1023218
FF1023213 = FF1023228
FF1023212 = FF1023227
FF1023210 = FF1023225
OL1038528 = OL1038529
FF1023294 = FF1023299
FF1023211 = FF1023226
FF1023208 = FF1023223
FF1023239 = FF1023240
FF1023250 = FF1023251
MES1012200 = MES1012202
OL1023291 = OL1023296
FF1023293 = FF1023298
FF1023295 = FF1023300
FF1023292 = FF1023297
NINTH NOTICE OF VIOLATIONS = TENTH NOTICE OF VIOLATIONS
NINTH VIOLATION TICKET = TENTH VIOLATION TICKET
NINTH NOTICE = TENTH NOTICE
NINTH STOP WORK NOTICE = TENTH STOP WORK NOTICE
"""

# Step 4: Parse the mappings into an ordered list of dictionaries
mappings = []
current_mapping = {}

def strip_html(text):
    """Strips basic HTML tags (e.g., <tag>content</tag>) from a string."""
    # This regex finds anything between '<' and '>' and replaces it with an empty string
    return re.sub(r'<[^>]*>', '', text).strip()

for line in mapping_text.strip().splitlines():
    line = line.strip()
    if line.startswith('#'):
        if current_mapping:
            mappings.append(current_mapping.copy())
            current_mapping = {}
        continue
    parts = line.split('=')
    if len(parts) == 2:
        left = strip_html(parts[0].strip().replace('\u200b', ''))
        right = parts[1].strip().replace('\u200b', '')
        current_mapping[left] = right
if current_mapping:
    mappings.append(current_mapping.copy())

# Step 5: Load input from a separate file
with open('generate letters input.txt', 'r', encoding='utf-8') as f:
    input_text = f.read()

# Step 6: Function to replace tokens
def replace_tokens(text, mapping):
    pattern = re.compile('|'.join(re.escape(k) for k in sorted(mapping, key=len, reverse=True)))
    return pattern.sub(lambda match: mapping.get(match.group(0), match.group(0)), text)

# Step 7: Define output filenames
output_filenames = [
    "letter_version_second.txt",
    "letter_version_third.txt",
    "letter_version_fourth.txt",
    "letter_version_fifth.txt",
    "letter_version_sixth.txt",
    "letter_version_seventh.txt",
    "letter_version_eighth.txt",
    "letter_version_ninth.txt",
    "letter_version_tenth.txt",
]

# Step 8: Perform sequential replacements and generate output files
current_text = input_text
for i, mapping in enumerate(mappings):
    current_text = replace_tokens(current_text, mapping)
    output_path = os.path.join(output_directory, output_filenames[i])
    with open(output_path, 'w', encoding='utf-8') as f:
        f.write(current_text)
    print(f"Generated: '{output_path}' after applying the '{mapping_text.strip().splitlines()[i*12]}' mapping") # Added mapping name for clarity

print(f"Done. Ten versions of the letter have been generated in the '{output_directory}' directory.")